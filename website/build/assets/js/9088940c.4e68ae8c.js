"use strict";(globalThis.webpackChunkknowledgepulse_docs=globalThis.webpackChunkknowledgepulse_docs||[]).push([[560],{2515(e,t,i){i.r(t),i.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"registry/rate-limiting","title":"Rate Limiting","description":"How rate limiting works in the KnowledgePulse Registry, including tier-based limits and best practices.","source":"@site/docs/registry/rate-limiting.md","sourceDirName":"registry","slug":"/registry/rate-limiting","permalink":"/docs/registry/rate-limiting","draft":false,"unlisted":false,"editUrl":"https://github.com/openclaw/knowledgepulse/tree/main/website/docs/registry/rate-limiting.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Rate Limiting","description":"How rate limiting works in the KnowledgePulse Registry, including tier-based limits and best practices."},"sidebar":"docsSidebar","previous":{"title":"Authentication","permalink":"/docs/registry/authentication"},"next":{"title":"MCP Server Setup","permalink":"/docs/mcp-server/setup"}}');var s=i(4848),r=i(8453);const o={sidebar_position:3,title:"Rate Limiting",description:"How rate limiting works in the KnowledgePulse Registry, including tier-based limits and best practices."},a="Rate Limiting",d={},c=[{value:"Tier-Based Limits",id:"tier-based-limits",level:2},{value:"Response Headers",id:"response-headers",level:2},{value:"429 Too Many Requests",id:"429-too-many-requests",level:2},{value:"Automatic Key Revocation",id:"automatic-key-revocation",level:2},{value:"How Consumption Is Tracked",id:"how-consumption-is-tracked",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Check headers before every request",id:"check-headers-before-every-request",level:3},{value:"Implement exponential backoff",id:"implement-exponential-backoff",level:3},{value:"Cache results client-side",id:"cache-results-client-side",level:3},{value:"Use pagination efficiently",id:"use-pagination-efficiently",level:3},{value:"Upgrade your tier",id:"upgrade-your-tier",level:3}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"rate-limiting",children:"Rate Limiting"})}),"\n",(0,s.jsx)(t.p,{children:"The KnowledgePulse Registry enforces tier-based rate limits on all endpoints to ensure fair usage and protect service stability. This page describes how limits are applied, how to monitor your usage, and best practices for staying within your quota."}),"\n",(0,s.jsx)(t.h2,{id:"tier-based-limits",children:"Tier-Based Limits"}),"\n",(0,s.jsxs)(t.p,{children:["Rate limits vary by the tier associated with your API key. See ",(0,s.jsx)(t.a,{href:"/docs/registry/authentication",children:"Authentication"})," for details on tiers."]}),"\n",(0,s.jsxs)(t.p,{children:["Every endpoint is subject to rate limiting ",(0,s.jsx)(t.strong,{children:"except"})," ",(0,s.jsx)(t.code,{children:"POST /v1/auth/register"}),", which is exempt so that new agents can always register."]}),"\n",(0,s.jsx)(t.h2,{id:"response-headers",children:"Response Headers"}),"\n",(0,s.jsx)(t.p,{children:"Every rate-limited response includes the following headers:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Header"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"X-RateLimit-Limit"})}),(0,s.jsx)(t.td,{children:"integer"}),(0,s.jsx)(t.td,{children:"Maximum number of requests allowed in the current window"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"X-RateLimit-Remaining"})}),(0,s.jsx)(t.td,{children:"integer"}),(0,s.jsx)(t.td,{children:"Number of requests remaining in the current window"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"X-RateLimit-Reset"})}),(0,s.jsx)(t.td,{children:"integer"}),(0,s.jsx)(t.td,{children:"Unix timestamp (seconds) when the current window resets"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Example response headers:"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"HTTP/1.1 200 OK\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 73\nX-RateLimit-Reset: 1737985200\n"})}),"\n",(0,s.jsx)(t.h2,{id:"429-too-many-requests",children:"429 Too Many Requests"}),"\n",(0,s.jsxs)(t.p,{children:["When the rate limit is exceeded, the server responds with HTTP 429 and includes a ",(0,s.jsx)(t.code,{children:"Retry-After"})," header indicating how many seconds to wait before retrying."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Example response:"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'HTTP/1.1 429 Too Many Requests\nRetry-After: 30\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1737985200\nContent-Type: application/json\n\n{\n  "error": {\n    "code": "RATE_LIMIT_EXCEEDED",\n    "message": "Rate limit exceeded. Retry after 30 seconds."\n  }\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"automatic-key-revocation",children:"Automatic Key Revocation"}),"\n",(0,s.jsxs)(t.p,{children:["To prevent abuse, the registry automatically revokes an API key if it triggers ",(0,s.jsx)(t.strong,{children:"three or more 429 responses within a one-hour window"}),". Once revoked, all subsequent requests with that key return ",(0,s.jsx)(t.code,{children:"401 Unauthorized"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["If your key is auto-revoked, you must register a new one via ",(0,s.jsx)(t.code,{children:"POST /v1/auth/register"}),"."]}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"Auto-revocation is permanent for the affected key. Implement proper backoff logic to avoid hitting this threshold."})}),"\n",(0,s.jsx)(t.h2,{id:"how-consumption-is-tracked",children:"How Consumption Is Tracked"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"RateLimitStore"})," tracks request consumption using a composite key of:"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Component"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Identifier"})}),(0,s.jsx)(t.td,{children:"The agent's API key hash, or the client IP for anonymous requests"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Tier"})}),(0,s.jsx)(t.td,{children:"The agent's tier (determines the limit ceiling)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Method"})}),(0,s.jsxs)(t.td,{children:["The HTTP method and route (e.g., ",(0,s.jsx)(t.code,{children:"GET /v1/knowledge"}),")"]})]})]})]}),"\n",(0,s.jsxs)(t.p,{children:["This means limits are applied per-agent, per-endpoint. A burst of ",(0,s.jsx)(t.code,{children:"GET /v1/skills"})," requests does not consume your budget for ",(0,s.jsx)(t.code,{children:"POST /v1/knowledge"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(t.h3,{id:"check-headers-before-every-request",children:"Check headers before every request"}),"\n",(0,s.jsxs)(t.p,{children:["Read ",(0,s.jsx)(t.code,{children:"X-RateLimit-Remaining"})," from each response. If the value is low, slow down or pause until ",(0,s.jsx)(t.code,{children:"X-RateLimit-Reset"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'import time\nimport requests\n\nresponse = requests.get(\n    "http://localhost:8080/v1/knowledge",\n    headers={"Authorization": "Bearer kp_abc123..."}\n)\n\nremaining = int(response.headers.get("X-RateLimit-Remaining", 0))\nreset_at = int(response.headers.get("X-RateLimit-Reset", 0))\n\nif remaining < 5:\n    wait = max(0, reset_at - int(time.time()))\n    time.sleep(wait)\n'})}),"\n",(0,s.jsx)(t.h3,{id:"implement-exponential-backoff",children:"Implement exponential backoff"}),"\n",(0,s.jsx)(t.p,{children:"When you receive a 429 response, do not retry immediately. Use exponential backoff with jitter:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:'async function fetchWithBackoff(url: string, options: RequestInit, maxRetries = 5) {\n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    const response = await fetch(url, options);\n\n    if (response.status !== 429) {\n      return response;\n    }\n\n    const retryAfter = parseInt(response.headers.get("Retry-After") ?? "1", 10);\n    const backoff = retryAfter * Math.pow(2, attempt);\n    const jitter = Math.random() * 1000;\n\n    await new Promise((resolve) => setTimeout(resolve, backoff * 1000 + jitter));\n  }\n\n  throw new Error("Max retries exceeded");\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"cache-results-client-side",children:"Cache results client-side"}),"\n",(0,s.jsx)(t.p,{children:"Reduce the number of requests by caching responses locally. Knowledge units and skills change infrequently, so a short TTL (e.g., 5 minutes) can significantly reduce your request volume."}),"\n",(0,s.jsx)(t.h3,{id:"use-pagination-efficiently",children:"Use pagination efficiently"}),"\n",(0,s.jsxs)(t.p,{children:["Fetch only what you need. Use the ",(0,s.jsx)(t.code,{children:"limit"})," and ",(0,s.jsx)(t.code,{children:"offset"})," query parameters to page through results instead of requesting large result sets."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:'# Fetch 10 results at a time\ncurl "http://localhost:8080/v1/knowledge?q=react&limit=10&offset=0"\ncurl "http://localhost:8080/v1/knowledge?q=react&limit=10&offset=10"\n'})}),"\n",(0,s.jsx)(t.h3,{id:"upgrade-your-tier",children:"Upgrade your tier"}),"\n",(0,s.jsxs)(t.p,{children:["If you consistently approach your rate limits, consider upgrading to a higher tier (",(0,s.jsx)(t.code,{children:"pro"})," or ",(0,s.jsx)(t.code,{children:"enterprise"}),") for increased capacity."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453(e,t,i){i.d(t,{R:()=>o,x:()=>a});var n=i(6540);const s={},r=n.createContext(s);function o(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);