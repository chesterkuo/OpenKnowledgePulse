"use strict";(globalThis.webpackChunkknowledgepulse_docs=globalThis.webpackChunkknowledgepulse_docs||[]).push([[951],{9525(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"sdk/scoring","title":"Scoring","description":"How the KnowledgePulse SDK evaluates the value of reasoning traces using a multi-dimensional scoring algorithm.","source":"@site/docs/sdk/scoring.md","sourceDirName":"sdk","slug":"/sdk/scoring","permalink":"/docs/sdk/scoring","draft":false,"unlisted":false,"editUrl":"https://github.com/openclaw/knowledgepulse/tree/main/website/docs/sdk/scoring.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Scoring","description":"How the KnowledgePulse SDK evaluates the value of reasoning traces using a multi-dimensional scoring algorithm."},"sidebar":"docsSidebar","previous":{"title":"SKILL.md","permalink":"/docs/sdk/skill-md"},"next":{"title":"Utilities","permalink":"/docs/sdk/utilities"}}');var i=s(4848),r=s(8453);const c={sidebar_position:4,title:"Scoring",description:"How the KnowledgePulse SDK evaluates the value of reasoning traces using a multi-dimensional scoring algorithm."},o="Scoring",d={},l=[{value:"<code>evaluateValue(trace)</code>",id:"evaluatevaluetrace",level:2},{value:"Scoring Dimensions",id:"scoring-dimensions",level:2},{value:"Complexity (C)",id:"complexity-c",level:3},{value:"Novelty (N)",id:"novelty-n",level:3},{value:"Tool Diversity (D)",id:"tool-diversity-d",level:3},{value:"Outcome Confidence (O)",id:"outcome-confidence-o",level:3},{value:"Rule-Based Overrides",id:"rule-based-overrides",level:2},{value:"Internal Vector Cache",id:"internal-vector-cache",level:2},{value:"Scoring Without the Embedder",id:"scoring-without-the-embedder",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"scoring",children:"Scoring"})}),"\n",(0,i.jsxs)(n.p,{children:["The SDK includes a value scoring function that evaluates how useful a ",(0,i.jsx)(n.code,{children:"ReasoningTrace"})," is before it is contributed to the network. This determines whether a trace meets the quality threshold for sharing."]}),"\n",(0,i.jsx)(n.h2,{id:"evaluatevaluetrace",children:(0,i.jsx)(n.code,{children:"evaluateValue(trace)"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"function evaluateValue(trace: ReasoningTrace): Promise<number>\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"trace"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ReasoningTrace"})}),(0,i.jsx)(n.td,{children:"A complete reasoning trace to evaluate"})]})})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Returns:"})," ",(0,i.jsx)(n.code,{children:"Promise<number>"})," -- a quality score between ",(0,i.jsx)(n.code,{children:"0.0"})," and ",(0,i.jsx)(n.code,{children:"1.0"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { evaluateValue } from "@knowledgepulse/sdk";\nimport type { ReasoningTrace } from "@knowledgepulse/sdk";\n\nconst trace: ReasoningTrace = {\n  "@context": "https://knowledgepulse.dev/schema/v1",\n  "@type": "ReasoningTrace",\n  id: "kp:trace:550e8400-e29b-41d4-a716-446655440000",\n  metadata: {\n    created_at: new Date().toISOString(),\n    task_domain: "code-review",\n    success: true,\n    quality_score: 0,\n    visibility: "network",\n    privacy_level: "aggregated",\n  },\n  task: { objective: "Review PR #42 for security issues" },\n  steps: [\n    { step_id: 0, type: "thought", content: "Analyzing diff for injection vectors" },\n    { step_id: 1, type: "tool_call", tool: { name: "github_pr_read" }, input: { pr: 42 } },\n    { step_id: 2, type: "observation", content: "Found unsanitized SQL in handler.ts" },\n    { step_id: 3, type: "tool_call", tool: { name: "static_analysis" }, input: { file: "handler.ts" } },\n    { step_id: 4, type: "observation", content: "Confirmed SQL injection vulnerability" },\n  ],\n  outcome: {\n    result_summary: "Identified 1 critical SQL injection vulnerability",\n    confidence: 0.95,\n  },\n};\n\nconst score = await evaluateValue(trace);\nconsole.log(score); // e.g. 0.72\n'})}),"\n",(0,i.jsx)(n.h2,{id:"scoring-dimensions",children:"Scoring Dimensions"}),"\n",(0,i.jsx)(n.p,{children:"The composite score is a weighted average of four independent dimensions:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Dimension"}),(0,i.jsx)(n.th,{children:"Weight"}),(0,i.jsx)(n.th,{children:"Range"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Complexity (C)"}),(0,i.jsx)(n.td,{children:"25%"}),(0,i.jsx)(n.td,{children:"0.0 - 1.0"}),(0,i.jsx)(n.td,{children:"How structurally rich the trace is"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Novelty (N)"}),(0,i.jsx)(n.td,{children:"35%"}),(0,i.jsx)(n.td,{children:"0.0 - 1.0"}),(0,i.jsx)(n.td,{children:"How different the trace is from previously seen traces"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Tool Diversity (D)"}),(0,i.jsx)(n.td,{children:"15%"}),(0,i.jsx)(n.td,{children:"0.0 - 1.0"}),(0,i.jsx)(n.td,{children:"Variety of tools used relative to step count"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Outcome Confidence (O)"}),(0,i.jsx)(n.td,{children:"25%"}),(0,i.jsx)(n.td,{children:"0.0 - 1.0"}),(0,i.jsx)(n.td,{children:"Confidence in the result, adjusted for success"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"score = C * 0.25 + N * 0.35 + D * 0.15 + O * 0.25\n"})}),"\n",(0,i.jsx)(n.h3,{id:"complexity-c",children:"Complexity (C)"}),"\n",(0,i.jsx)(n.p,{children:"Measures the structural richness of the reasoning trace based on step type variety, error recovery, and trace length."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"C = min(1.0, (uniqueTypes / 4) * 0.5 + (errorRecovery > 0 ? 0.3 : 0) + (steps.length / 20) * 0.2)\n"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Factor"}),(0,i.jsx)(n.th,{children:"Contribution"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Unique step types"}),(0,i.jsx)(n.td,{children:"up to 0.50"}),(0,i.jsxs)(n.td,{children:["Number of distinct step types (",(0,i.jsx)(n.code,{children:"thought"}),", ",(0,i.jsx)(n.code,{children:"tool_call"}),", ",(0,i.jsx)(n.code,{children:"observation"}),", ",(0,i.jsx)(n.code,{children:"error_recovery"}),") divided by 4"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Error recovery"}),(0,i.jsx)(n.td,{children:"0.00 or 0.30"}),(0,i.jsxs)(n.td,{children:["Bonus if the trace contains at least one ",(0,i.jsx)(n.code,{children:"error_recovery"})," step"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Step count"}),(0,i.jsx)(n.td,{children:"up to 0.20"}),(0,i.jsx)(n.td,{children:"Number of steps divided by 20 (longer traces score higher, capped at 20)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"novelty-n",children:"Novelty (N)"}),"\n",(0,i.jsx)(n.p,{children:"Measures how different a trace is from previously scored traces using embedding-based similarity."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Embedding model:"})," ",(0,i.jsx)(n.code,{children:"Xenova/all-MiniLM-L6-v2"})," (384 dimensions)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Input text:"})," task objective concatenated with all step contents"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Comparison:"})," cosine similarity against all vectors in the local cache"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Formula:"})," ",(0,i.jsx)(n.code,{children:"N = 1.0 - maxCosineSimilarity(embedding, cache)"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"@huggingface/transformers"})," package is not installed, the novelty dimension ",(0,i.jsxs)(n.strong,{children:["falls back to ",(0,i.jsx)(n.code,{children:"0.5"})]})," (the midpoint). This ensures scoring still works without the optional dependency, albeit with reduced discrimination on novelty."]}),"\n",(0,i.jsxs)(n.p,{children:["When the local cache is empty (first trace scored in a session), novelty also defaults to ",(0,i.jsx)(n.code,{children:"0.5"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"tool-diversity-d",children:"Tool Diversity (D)"}),"\n",(0,i.jsx)(n.p,{children:"Measures the variety of distinct tools used in the trace."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"D = min(1.0, (uniqueTools / max(1, steps.length)) * 3)\n"})}),"\n",(0,i.jsx)(n.p,{children:"The multiplier of 3 means that a trace where one-third of steps use different tools will achieve the maximum score. This rewards traces that leverage multiple tools without penalizing long sequences of tool calls."}),"\n",(0,i.jsx)(n.h3,{id:"outcome-confidence-o",children:"Outcome Confidence (O)"}),"\n",(0,i.jsx)(n.p,{children:"Reflects the agent's self-reported confidence, adjusted by whether the task actually succeeded."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"O = outcome.confidence * (metadata.success ? 1.0 : 0.3)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Failed tasks have their confidence multiplied by 0.3, significantly reducing the outcome dimension score."}),"\n",(0,i.jsx)(n.h2,{id:"rule-based-overrides",children:"Rule-Based Overrides"}),"\n",(0,i.jsx)(n.p,{children:"After computing the weighted composite score, three rule-based adjustments are applied in order:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Condition"}),(0,i.jsx)(n.th,{children:"Effect"}),(0,i.jsx)(n.th,{children:"Rationale"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Single thought-only step"}),(0,i.jsxs)(n.td,{children:["Score set to ",(0,i.jsx)(n.code,{children:"0.1"})]}),(0,i.jsx)(n.td,{children:"A trace with one thought step has minimal value"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["More than 2 error recoveries and ",(0,i.jsx)(n.code,{children:"success: true"})]}),(0,i.jsxs)(n.td,{children:["Score increased by ",(0,i.jsx)(n.code,{children:"+0.1"})," (capped at 1.0)"]}),(0,i.jsx)(n.td,{children:"Successful recovery from multiple errors is highly valuable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1 or fewer unique tools (when tools are used)"}),(0,i.jsxs)(n.td,{children:["Score decreased by ",(0,i.jsx)(n.code,{children:"-0.1"})," (floored at 0.0)"]}),(0,i.jsx)(n.td,{children:"Low tool diversity in tool-using traces is penalized"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'// Single thought-only step\nif (steps.length === 1 && steps[0].type === "thought") score = 0.1;\n\n// Successful multi-error recovery\nif (errorRecovery > 2 && metadata.success) score = min(1.0, score + 0.1);\n\n// Low tool diversity\nif (uniqueTools <= 1 && steps.some(s => s.tool)) score = max(0.0, score - 0.1);\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The single-thought override takes precedence: if a trace has exactly one thought step, the score is set to ",(0,i.jsx)(n.code,{children:"0.1"})," regardless of other factors. The subsequent overrides then apply on top of that value if their conditions are also met."]})}),"\n",(0,i.jsx)(n.h2,{id:"internal-vector-cache",children:"Internal Vector Cache"}),"\n",(0,i.jsxs)(n.p,{children:["The scoring module maintains an internal ",(0,i.jsx)(n.code,{children:"VectorCache"})," instance for computing novelty across invocations within the same process."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Value"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Max elements"}),(0,i.jsx)(n.td,{children:"1,000"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Dimensions"}),(0,i.jsx)(n.td,{children:"384"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Algorithm"}),(0,i.jsx)(n.td,{children:"Brute-force linear scan"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Eviction"}),(0,i.jsx)(n.td,{children:"Oldest-first when over capacity"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"The cache is designed for the common case of scoring traces in a single agent session. At 1,000 vectors of 384 dimensions each, the memory footprint is approximately 1.5 MB and a full scan completes in under 1 ms."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"VectorCache"})," class is also exported from the SDK for advanced use cases:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'import { VectorCache } from "@knowledgepulse/sdk";\n\nconst cache = new VectorCache({ maxElements: 500, dimensions: 384 });\n\ncache.add(new Float32Array(384));           // Add a vector\nconst sim = cache.maxCosineSimilarity(q);   // Query max similarity\nconsole.log(cache.size);                     // Number of stored vectors\ncache.clear();                               // Reset the cache\n'})}),"\n",(0,i.jsx)(n.h2,{id:"scoring-without-the-embedder",children:"Scoring Without the Embedder"}),"\n",(0,i.jsxs)(n.p,{children:["If you do not install ",(0,i.jsx)(n.code,{children:"@huggingface/transformers"}),", the scoring function still works. The novelty dimension defaults to ",(0,i.jsx)(n.code,{children:"0.5"}),", and the final score is computed from the remaining three dimensions plus the fixed novelty midpoint:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"score = C * 0.25 + 0.5 * 0.35 + D * 0.15 + O * 0.25\n       = C * 0.25 + 0.175 + D * 0.15 + O * 0.25\n"})}),"\n",(0,i.jsx)(n.p,{children:"This is suitable for development and testing but provides less discriminating scores in production. For best results, install the optional dependency:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bun add @huggingface/transformers\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>c,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function c(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);