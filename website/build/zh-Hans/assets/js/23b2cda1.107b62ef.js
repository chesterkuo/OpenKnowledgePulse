"use strict";(globalThis.webpackChunkknowledgepulse_docs=globalThis.webpackChunkknowledgepulse_docs||[]).push([[353],{7272(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>a,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"registry/rate-limiting","title":"\u901f\u7387\u9650\u5236","description":"KnowledgePulse Registry \u4e2d\u901f\u7387\u9650\u5236\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236\u548c\u6700\u4f73\u5b9e\u8df5\u3002","source":"@site/i18n/zh-Hans/docusaurus-plugin-content-docs/current/registry/rate-limiting.md","sourceDirName":"registry","slug":"/registry/rate-limiting","permalink":"/zh-Hans/docs/registry/rate-limiting","draft":false,"unlisted":false,"editUrl":"https://github.com/openclaw/knowledgepulse/tree/main/website/docs/registry/rate-limiting.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"\u901f\u7387\u9650\u5236","description":"KnowledgePulse Registry \u4e2d\u901f\u7387\u9650\u5236\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236\u548c\u6700\u4f73\u5b9e\u8df5\u3002"},"sidebar":"docsSidebar","previous":{"title":"\u8ba4\u8bc1","permalink":"/zh-Hans/docs/registry/authentication"},"next":{"title":"MCP \u670d\u52a1\u5668\u8bbe\u7f6e","permalink":"/zh-Hans/docs/mcp-server/setup"}}');var s=t(4848),r=t(8453);const d={sidebar_position:3,title:"\u901f\u7387\u9650\u5236",description:"KnowledgePulse Registry \u4e2d\u901f\u7387\u9650\u5236\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5305\u62ec\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236\u548c\u6700\u4f73\u5b9e\u8df5\u3002"},l="\u901f\u7387\u9650\u5236",c={},o=[{value:"\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236",id:"\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236",level:2},{value:"\u54cd\u5e94\u5934",id:"\u54cd\u5e94\u5934",level:2},{value:"429 \u8bf7\u6c42\u8fc7\u591a",id:"429-\u8bf7\u6c42\u8fc7\u591a",level:2},{value:"\u81ea\u52a8\u5bc6\u94a5\u64a4\u9500",id:"\u81ea\u52a8\u5bc6\u94a5\u64a4\u9500",level:2},{value:"\u6d88\u8017\u91cf\u8ddf\u8e2a\u65b9\u5f0f",id:"\u6d88\u8017\u91cf\u8ddf\u8e2a\u65b9\u5f0f",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u5728\u6bcf\u6b21\u8bf7\u6c42\u524d\u68c0\u67e5\u8bf7\u6c42\u5934",id:"\u5728\u6bcf\u6b21\u8bf7\u6c42\u524d\u68c0\u67e5\u8bf7\u6c42\u5934",level:3},{value:"\u5b9e\u73b0\u6307\u6570\u9000\u907f",id:"\u5b9e\u73b0\u6307\u6570\u9000\u907f",level:3},{value:"\u5ba2\u6237\u7aef\u7f13\u5b58\u7ed3\u679c",id:"\u5ba2\u6237\u7aef\u7f13\u5b58\u7ed3\u679c",level:3},{value:"\u9ad8\u6548\u4f7f\u7528\u5206\u9875",id:"\u9ad8\u6548\u4f7f\u7528\u5206\u9875",level:3},{value:"\u5347\u7ea7\u60a8\u7684\u5c42\u7ea7",id:"\u5347\u7ea7\u60a8\u7684\u5c42\u7ea7",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u901f\u7387\u9650\u5236",children:"\u901f\u7387\u9650\u5236"})}),"\n",(0,s.jsx)(n.p,{children:"KnowledgePulse Registry \u5bf9\u6240\u6709\u7aef\u70b9\u5b9e\u65bd\u57fa\u4e8e\u5c42\u7ea7\u7684\u901f\u7387\u9650\u5236\uff0c\u4ee5\u786e\u4fdd\u516c\u5e73\u4f7f\u7528\u5e76\u4fdd\u62a4\u670d\u52a1\u7a33\u5b9a\u6027\u3002\u672c\u9875\u4ecb\u7ecd\u9650\u5236\u7684\u5e94\u7528\u65b9\u5f0f\u3001\u5982\u4f55\u76d1\u63a7\u4f7f\u7528\u60c5\u51b5\u4ee5\u53ca\u5728\u914d\u989d\u5185\u64cd\u4f5c\u7684\u6700\u4f73\u5b9e\u8df5\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236",children:"\u57fa\u4e8e\u5c42\u7ea7\u7684\u9650\u5236"}),"\n",(0,s.jsxs)(n.p,{children:["\u901f\u7387\u9650\u5236\u6839\u636e API \u5bc6\u94a5\u5173\u8054\u7684\u5c42\u7ea7\u800c\u53d8\u5316\u3002\u6709\u5173\u5c42\u7ea7\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1",(0,s.jsx)(n.a,{href:"/zh-Hans/docs/registry/authentication",children:"\u8ba4\u8bc1"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u6709\u7aef\u70b9\u5747\u53d7\u901f\u7387\u9650\u5236\uff0c",(0,s.jsx)(n.strong,{children:"\u4f46"})," ",(0,s.jsx)(n.code,{children:"POST /v1/auth/register"})," \u9664\u5916\uff0c\u8be5\u7aef\u70b9\u8c41\u514d\u901f\u7387\u9650\u5236\u4ee5\u786e\u4fdd\u65b0\u4ee3\u7406\u53ef\u4ee5\u968f\u65f6\u6ce8\u518c\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u54cd\u5e94\u5934",children:"\u54cd\u5e94\u5934"}),"\n",(0,s.jsx)(n.p,{children:"\u6bcf\u4e2a\u53d7\u901f\u7387\u9650\u5236\u7684\u54cd\u5e94\u90fd\u5305\u542b\u4ee5\u4e0b\u8bf7\u6c42\u5934\uff1a"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u8bf7\u6c42\u5934"}),(0,s.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-RateLimit-Limit"})}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:"\u5f53\u524d\u65f6\u95f4\u7a97\u53e3\u5185\u5141\u8bb8\u7684\u6700\u5927\u8bf7\u6c42\u6570"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-RateLimit-Remaining"})}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:"\u5f53\u524d\u65f6\u95f4\u7a97\u53e3\u5185\u5269\u4f59\u7684\u8bf7\u6c42\u6570"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"X-RateLimit-Reset"})}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:"\u5f53\u524d\u65f6\u95f4\u7a97\u53e3\u91cd\u7f6e\u7684 Unix \u65f6\u95f4\u6233\uff08\u79d2\uff09"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u793a\u4f8b\u54cd\u5e94\u5934\uff1a"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"HTTP/1.1 200 OK\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 73\nX-RateLimit-Reset: 1737985200\n"})}),"\n",(0,s.jsx)(n.h2,{id:"429-\u8bf7\u6c42\u8fc7\u591a",children:"429 \u8bf7\u6c42\u8fc7\u591a"}),"\n",(0,s.jsxs)(n.p,{children:["\u5f53\u8d85\u51fa\u901f\u7387\u9650\u5236\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u8fd4\u56de HTTP 429 \u54cd\u5e94\uff0c\u5e76\u5305\u542b\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"Retry-After"})," \u8bf7\u6c42\u5934\uff0c\u6307\u793a\u5728\u91cd\u8bd5\u4e4b\u524d\u9700\u8981\u7b49\u5f85\u7684\u79d2\u6570\u3002"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"\u793a\u4f8b\u54cd\u5e94\uff1a"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'HTTP/1.1 429 Too Many Requests\nRetry-After: 30\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 0\nX-RateLimit-Reset: 1737985200\nContent-Type: application/json\n\n{\n  "error": {\n    "code": "RATE_LIMIT_EXCEEDED",\n    "message": "Rate limit exceeded. Retry after 30 seconds."\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u81ea\u52a8\u5bc6\u94a5\u64a4\u9500",children:"\u81ea\u52a8\u5bc6\u94a5\u64a4\u9500"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e3a\u9632\u6b62\u6ee5\u7528\uff0c\u5982\u679c\u67d0\u4e2a API \u5bc6\u94a5\u5728",(0,s.jsx)(n.strong,{children:"\u4e00\u5c0f\u65f6\u5185\u89e6\u53d1\u4e09\u6b21\u6216\u4ee5\u4e0a 429 \u54cd\u5e94"}),"\uff0cRegistry \u4f1a\u81ea\u52a8\u64a4\u9500\u8be5\u5bc6\u94a5\u3002\u4e00\u65e6\u88ab\u64a4\u9500\uff0c\u4f7f\u7528\u8be5\u5bc6\u94a5\u7684\u6240\u6709\u540e\u7eed\u8bf7\u6c42\u5c06\u8fd4\u56de ",(0,s.jsx)(n.code,{children:"401 Unauthorized"}),"\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u60a8\u7684\u5bc6\u94a5\u88ab\u81ea\u52a8\u64a4\u9500\uff0c\u60a8\u5fc5\u987b\u901a\u8fc7 ",(0,s.jsx)(n.code,{children:"POST /v1/auth/register"})," \u91cd\u65b0\u6ce8\u518c\u4e00\u4e2a\u65b0\u7684\u5bc6\u94a5\u3002"]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"\u81ea\u52a8\u64a4\u9500\u5bf9\u53d7\u5f71\u54cd\u7684\u5bc6\u94a5\u662f\u6c38\u4e45\u6027\u7684\u3002\u8bf7\u5b9e\u73b0\u9002\u5f53\u7684\u9000\u907f\u903b\u8f91\uff0c\u907f\u514d\u89e6\u53d1\u6b64\u9608\u503c\u3002"})}),"\n",(0,s.jsx)(n.h2,{id:"\u6d88\u8017\u91cf\u8ddf\u8e2a\u65b9\u5f0f",children:"\u6d88\u8017\u91cf\u8ddf\u8e2a\u65b9\u5f0f"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"RateLimitStore"})," \u4f7f\u7528\u4ee5\u4e0b\u7ec4\u5408\u952e\u8ddf\u8e2a\u8bf7\u6c42\u6d88\u8017\u91cf\uff1a"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"\u7ec4\u4ef6"}),(0,s.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"\u6807\u8bc6\u7b26"})}),(0,s.jsx)(n.td,{children:"\u4ee3\u7406\u7684 API \u5bc6\u94a5\u54c8\u5e0c\u503c\uff0c\u6216\u533f\u540d\u8bf7\u6c42\u7684\u5ba2\u6237\u7aef IP"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"\u5c42\u7ea7"})}),(0,s.jsx)(n.td,{children:"\u4ee3\u7406\u7684\u5c42\u7ea7\uff08\u51b3\u5b9a\u9650\u5236\u4e0a\u9650\uff09"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"\u65b9\u6cd5"})}),(0,s.jsxs)(n.td,{children:["HTTP \u65b9\u6cd5\u548c\u8def\u7531\uff08\u4f8b\u5982 ",(0,s.jsx)(n.code,{children:"GET /v1/knowledge"}),"\uff09"]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["\u8fd9\u610f\u5473\u7740\u9650\u5236\u662f\u6309\u4ee3\u7406\u3001\u6309\u7aef\u70b9\u5206\u522b\u5e94\u7528\u7684\u3002\u5927\u91cf\u7684 ",(0,s.jsx)(n.code,{children:"GET /v1/skills"})," \u8bf7\u6c42\u4e0d\u4f1a\u6d88\u8017\u60a8\u5728 ",(0,s.jsx)(n.code,{children:"POST /v1/knowledge"})," \u4e0a\u7684\u9884\u7b97\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,s.jsx)(n.h3,{id:"\u5728\u6bcf\u6b21\u8bf7\u6c42\u524d\u68c0\u67e5\u8bf7\u6c42\u5934",children:"\u5728\u6bcf\u6b21\u8bf7\u6c42\u524d\u68c0\u67e5\u8bf7\u6c42\u5934"}),"\n",(0,s.jsxs)(n.p,{children:["\u4ece\u6bcf\u4e2a\u54cd\u5e94\u4e2d\u8bfb\u53d6 ",(0,s.jsx)(n.code,{children:"X-RateLimit-Remaining"}),"\u3002\u5982\u679c\u503c\u8f83\u4f4e\uff0c\u8bf7\u51cf\u6162\u901f\u5ea6\u6216\u6682\u505c\uff0c\u76f4\u5230 ",(0,s.jsx)(n.code,{children:"X-RateLimit-Reset"})," \u65f6\u95f4\u5230\u8fbe\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import time\nimport requests\n\nresponse = requests.get(\n    "http://localhost:8080/v1/knowledge",\n    headers={"Authorization": "Bearer kp_abc123..."}\n)\n\nremaining = int(response.headers.get("X-RateLimit-Remaining", 0))\nreset_at = int(response.headers.get("X-RateLimit-Reset", 0))\n\nif remaining < 5:\n    wait = max(0, reset_at - int(time.time()))\n    time.sleep(wait)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b9e\u73b0\u6307\u6570\u9000\u907f",children:"\u5b9e\u73b0\u6307\u6570\u9000\u907f"}),"\n",(0,s.jsx)(n.p,{children:"\u5f53\u6536\u5230 429 \u54cd\u5e94\u65f6\uff0c\u4e0d\u8981\u7acb\u5373\u91cd\u8bd5\u3002\u4f7f\u7528\u5e26\u6709\u968f\u673a\u6296\u52a8\u7684\u6307\u6570\u9000\u907f\u7b56\u7565\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'async function fetchWithBackoff(url: string, options: RequestInit, maxRetries = 5) {\n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    const response = await fetch(url, options);\n\n    if (response.status !== 429) {\n      return response;\n    }\n\n    const retryAfter = parseInt(response.headers.get("Retry-After") ?? "1", 10);\n    const backoff = retryAfter * Math.pow(2, attempt);\n    const jitter = Math.random() * 1000;\n\n    await new Promise((resolve) => setTimeout(resolve, backoff * 1000 + jitter));\n  }\n\n  throw new Error("Max retries exceeded");\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef\u7f13\u5b58\u7ed3\u679c",children:"\u5ba2\u6237\u7aef\u7f13\u5b58\u7ed3\u679c"}),"\n",(0,s.jsx)(n.p,{children:"\u901a\u8fc7\u5728\u672c\u5730\u7f13\u5b58\u54cd\u5e94\u6765\u51cf\u5c11\u8bf7\u6c42\u6b21\u6570\u3002\u77e5\u8bc6\u5355\u5143\u548c\u6280\u80fd\u53d8\u66f4\u4e0d\u9891\u7e41\uff0c\u56e0\u6b64\u8bbe\u7f6e\u8f83\u77ed\u7684 TTL\uff08\u4f8b\u5982 5 \u5206\u949f\uff09\u53ef\u4ee5\u663e\u8457\u964d\u4f4e\u60a8\u7684\u8bf7\u6c42\u91cf\u3002"}),"\n",(0,s.jsx)(n.h3,{id:"\u9ad8\u6548\u4f7f\u7528\u5206\u9875",children:"\u9ad8\u6548\u4f7f\u7528\u5206\u9875"}),"\n",(0,s.jsxs)(n.p,{children:["\u53ea\u83b7\u53d6\u60a8\u9700\u8981\u7684\u6570\u636e\u3002\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"limit"})," \u548c ",(0,s.jsx)(n.code,{children:"offset"})," \u67e5\u8be2\u53c2\u6570\u9010\u9875\u6d4f\u89c8\u7ed3\u679c\uff0c\u800c\u4e0d\u662f\u8bf7\u6c42\u5927\u578b\u7ed3\u679c\u96c6\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# \u6bcf\u6b21\u83b7\u53d6 10 \u6761\u7ed3\u679c\ncurl "http://localhost:8080/v1/knowledge?q=react&limit=10&offset=0"\ncurl "http://localhost:8080/v1/knowledge?q=react&limit=10&offset=10"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u5347\u7ea7\u60a8\u7684\u5c42\u7ea7",children:"\u5347\u7ea7\u60a8\u7684\u5c42\u7ea7"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u60a8\u6301\u7eed\u63a5\u8fd1\u901f\u7387\u9650\u5236\uff0c\u8bf7\u8003\u8651\u5347\u7ea7\u5230\u66f4\u9ad8\u7684\u5c42\u7ea7\uff08",(0,s.jsx)(n.code,{children:"pro"})," \u6216 ",(0,s.jsx)(n.code,{children:"enterprise"}),"\uff09\u4ee5\u83b7\u5f97\u66f4\u5927\u7684\u5bb9\u91cf\u3002"]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},8453(e,n,t){t.d(n,{R:()=>d,x:()=>l});var i=t(6540);const s={},r=i.createContext(s);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);