---
sidebar_position: 2
title: デシジョンツリーエディター
description: React Flow キャンバスを使用して、ステップ、条件、ツールノードで SOP デシジョンツリーをビジュアルに構築します。
sidebar_label: デシジョンツリーエディター
---

# デシジョンツリーエディター

デシジョンツリーエディターは SOP Studio の中核です。React Flow を搭載したビジュアルキャンバスで、SOP のデシジョンツリーを構築、接続、設定できます。

## キャンバスの概要

エディターは3つのエリアで構成されています：

| エリア | 目的 |
|------|---------|
| **ノードパレット**（左） | ノードタイプをキャンバスにドラッグ |
| **キャンバス**（中央） | デシジョンツリーのビジュアルグラフ |
| **プロパティパネル**（右） | 選択したノードのプロパティを編集 |

## ノードタイプ

### Step ノード

Step ノードは SOP 内の単一のアクションまたは指示を表します。

| プロパティ | 型 | 説明 |
|----------|------|-------------|
| `step` | string | 一意のステップ識別子 |
| `instruction` | string | このステップで実行する内容 |
| `criteria` | Record | 評価基準を定義するキーバリューペア |
| `tool_suggestions` | Array | このステップを支援するオプションのツール |

### Condition ノード

Condition ノードは分岐ロジックを作成します。各出力エッジは可能な条件値を表します。

| プロパティ | 型 | 説明 |
|----------|------|-------------|
| `field` | string | 評価するフィールドまたは変数 |
| `conditions` | Record | 条件値をアクションにマッピング |
| `sla_min` | number | ブランチごとのオプションの SLA（分） |

### Tool ノード

Tool ノードは、フロー内の特定のポイントで呼び出す外部 MCP ツールまたは API を参照します。

| プロパティ | 型 | 説明 |
|----------|------|-------------|
| `name` | string | ツール名（MCP ツールレジストリと一致する必要あり） |
| `when` | string | ツールを呼び出す条件 |
| `input_template` | Record | デフォルトの入力パラメータ |

## キャンバスの操作

### ノードの追加

左のパレットからノードタイプをキャンバスにドラッグします。ノードはデフォルトのプロパティで表示され、右パネルで編集できます。

### ノードの接続

ノードの出力ハンドル（下部）をクリックし、別のノードの入力ハンドル（上部）にドラッグしてエッジを作成します。Condition ノードの場合、各エッジに条件値のラベルを付けることができます。

### プロパティの編集

任意のノードを選択すると、右パネルでプロパティを表示・編集できます。変更はリアルタイムでキャンバスに反映されます。

### キーボードショートカット

| ショートカット | アクション |
|----------|--------|
| `Ctrl+S` | SOP を保存 |
| `Ctrl+Z` | 元に戻す |
| `Ctrl+Shift+Z` | やり直し |
| `Delete` | 選択したノードまたはエッジを削除 |
| `Ctrl+A` | すべてのノードを選択 |
| `Ctrl+D` | 選択したノードを複製 |

## 保存とエクスポート

### レジストリへの保存

「Save」をクリックするか `Ctrl+S` を押して、SOP を接続された KnowledgePulse レジストリに保存します。SOP は `ExpertSOP` ナレッジユニットとして保存されます。

### Skill-MD としてエクスポート

「Export > Skill-MD」をクリックして、SOP から `SKILL.md` ファイルを生成します。KnowledgePulse 拡張フィールドを含むポータブルな Markdown ファイルが生成されます。

```bash
# エクスポートされた SKILL.md の構造
---
name: Bug Triage
description: Standard procedure for classifying and routing bugs
version: "1.0"
tags: [engineering, triage]
kp:
  domain: engineering
  knowledge_capture: true
  visibility: org
---

## Steps
1. Classify the bug by severity
   - **Critical**: Escalate to on-call (SLA: 15 min)
   - **Major**: Assign to sprint (SLA: 60 min)
   - **Minor**: Add to backlog
```

### JSON としてエクスポート

「Export > JSON」をクリックして、SDK や API で使用するための生の `ExpertSOP` JSON 構造をダウンロードします。

## バリデーション

エディターはデシジョンツリーをリアルタイムでバリデーションします：

- **未接続のノード** -- 入力または出力エッジのないノードがある場合に警告
- **指示の欠落** -- Step ノードに指示テキストがない場合に警告
- **重複するステップ ID** -- 2つのノードが同じステップ識別子を共有する場合にエラー
- **循環参照** -- グラフにサイクルが含まれる場合にエラー

バリデーションの問題は、影響を受けるノード上のカラーバッジと下部のステータスバーに表示されます。
