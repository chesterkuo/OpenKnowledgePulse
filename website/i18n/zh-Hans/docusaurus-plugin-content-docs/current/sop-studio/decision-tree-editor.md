---
sidebar_position: 2
title: 决策树编辑器
description: 使用 React Flow 画布可视化构建 SOP 决策树，包含步骤、条件和工具节点。
---

# 决策树编辑器

决策树编辑器是 SOP 工作室的核心组件。它提供一个基于 React Flow 的可视化画布，用于构建、连接和配置 SOP 决策树。

## 画布概览

编辑器由三个区域组成：

| 区域 | 用途 |
|------|------|
| **节点面板**（左侧） | 将节点类型拖拽到画布上 |
| **画布**（中央） | 决策树的可视化图形 |
| **属性面板**（右侧） | 编辑选中节点的属性 |

## 节点类型

### 步骤节点

步骤节点代表 SOP 中的单个操作或指令。

| 属性 | 类型 | 描述 |
|------|------|------|
| `step` | string | 唯一的步骤标识符 |
| `instruction` | string | 此步骤需要执行的操作 |
| `criteria` | Record | 定义评估标准的键值对 |
| `tool_suggestions` | Array | 可辅助此步骤的可选工具 |

### 条件节点

条件节点用于创建分支逻辑。每条出边代表一个可能的条件值。

| 属性 | 类型 | 描述 |
|------|------|------|
| `field` | string | 要评估的字段或变量 |
| `conditions` | Record | 将条件值映射到操作 |
| `sla_min` | number | 每个分支的可选 SLA（分钟） |

### 工具节点

工具节点引用一个外部 MCP 工具或 API，在流程的特定点调用。

| 属性 | 类型 | 描述 |
|------|------|------|
| `name` | string | 工具名称（必须与 MCP 工具注册表匹配） |
| `when` | string | 调用工具的条件 |
| `input_template` | Record | 默认输入参数 |

## 使用画布

### 添加节点

从左侧面板拖拽节点类型到画布上。节点将以默认属性显示，可在右侧面板中编辑。

### 连接节点

点击节点的输出端口（底部）并拖拽到另一个节点的输入端口（顶部）以创建边线。对于条件节点，每条边线可标注其代表的条件值。

### 编辑属性

选中任意节点即可在右侧面板中查看和编辑其属性。更改会实时反映在画布上。

### 键盘快捷键

| 快捷键 | 操作 |
|--------|------|
| `Ctrl+S` | 保存 SOP |
| `Ctrl+Z` | 撤销 |
| `Ctrl+Shift+Z` | 重做 |
| `Delete` | 删除选中的节点或边线 |
| `Ctrl+A` | 选择所有节点 |
| `Ctrl+D` | 复制选中的节点 |

## 保存与导出

### 保存到注册中心

点击"保存"或按 `Ctrl+S` 将 SOP 持久化到已连接的 KnowledgePulse 注册中心。SOP 将作为 `ExpertSOP` 知识单元存储。

### 导出为 Skill-MD

点击"导出 > Skill-MD"从 SOP 生成 `SKILL.md` 文件。这将生成一个包含 KnowledgePulse 扩展字段的可移植 Markdown 文件。

```bash
# 导出的 SKILL.md 结构
---
name: Bug Triage
description: 分类和路由 Bug 的标准程序
version: "1.0"
tags: [engineering, triage]
kp:
  domain: engineering
  knowledge_capture: true
  visibility: org
---

## Steps
1. 按严重程度分类 Bug
   - **严重**: 升级至值班人员 (SLA: 15 分钟)
   - **重要**: 分配到迭代 (SLA: 60 分钟)
   - **轻微**: 加入待办
```

### 导出为 JSON

点击"导出 > JSON"下载原始 `ExpertSOP` JSON 结构，可配合 SDK 或 API 使用。

## 验证

编辑器会实时验证你的决策树：

- **断开的节点** -- 如果任何节点没有入边或出边，将发出警告
- **缺失指令** -- 如果步骤节点没有指令文本，将发出警告
- **重复步骤 ID** -- 如果两个节点共享相同的步骤标识符，将报错
- **循环引用** -- 如果图形包含环路，将报错

验证问题会在受影响节点上以彩色徽章显示，并在底部状态栏中展示。
